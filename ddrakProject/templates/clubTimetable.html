{% extends "base_timetable.html" %}


{% load i18n static %}

{% block head_title %}{% trans "동아리별 시간표" %}{% endblock %}

{% block tab_id %}id="home_tab"{% endblock %}

{% block extra_list %}
<li><a href="/timetable/"><i class="material-icons left">home</i>메인</a></li>
{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/css/materialize.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/js/materialize.min.js"></script>
<link rel='stylesheet' type='text/css' href="{% static 'fullcalendar/dist/fullcalendar.css' %}" />
<link rel='stylesheet' type='text/css' href="{% static 'calendar.css' %}" />
<script type='text/javascript' src="{% static 'moment/moment.js' %}"></script>
<script type='text/javascript' src="{% static 'fullcalendar/dist/fullcalendar.js' %}"></script>
{% endblock %}

{% block body %}
<div id="calendar">
<script type='text/javascript'>
$(document).ready(function() {
    // page is now ready, initialize the calendar...
    $('#calendar').fullCalendar({
        header: {
            left: 'title',
            center: '',
            right: 'agendaWeek,agendaFiveDay prev,next today',
        },
        views: {
            agendaFiveDay: {
                type: 'agenda',
                duration: { days: 5 },
            },
        },
        eventClick: function(calEvent){
            var remove;
            {% if user.username == '악의꽃admin' or user.username == '막무간애admin' or user.username == '모여락admin' %}
            remove = confirm(calEvent.title + '\n시작: ' + calEvent.start.format('YYYY-MM-DD HH:mm:SS')
                            + '\n끝: ' + calEvent.end.format('YYYY-MM-DD HH:mm:SS') + '\n\n이 일정을 삭제하시겠습니까?');
            if(remove) {
                var form = document.createElement("form");
                form.setAttribute("method", "Post");
                form.setAttribute("action", '/DeleteEvent/');

                var hiddenField1 = document.createElement("input");
                hiddenField1.setAttribute("type", "hidden");
                hiddenField1.setAttribute("name", "title");
                hiddenField1.setAttribute("value", calEvent.title);
                var hiddenField2 = document.createElement("input");
                hiddenField2.setAttribute("type", "hidden");
                hiddenField2.setAttribute("name", "start");
                hiddenField2.setAttribute("value", calEvent.start.format('YYYY-MM-DD HH:mm:SS'));
                var hiddenField3 = document.createElement("input");
                hiddenField3.setAttribute("type", "hidden");
                hiddenField3.setAttribute("name", "end");
                hiddenField3.setAttribute("value", calEvent.end.format('YYYY-MM-DD HH:mm:SS'));
                var hiddenField4 = document.createElement("input");
                hiddenField4.setAttribute("type", "hidden");
                hiddenField4.setAttribute("name", 'csrfmiddlewaretoken');
                hiddenField4.setAttribute("value", '{% csrf_token %}');
                var hiddenField5 = document.createElement("input");
                hiddenField5.setAttribute("type", "hidden");
                hiddenField5.setAttribute("name", 'username');
                hiddenField5.setAttribute("value", '{{ user.username }}');

                form.appendChild(hiddenField1);
                form.appendChild(hiddenField2);
                form.appendChild(hiddenField3);
                form.appendChild(hiddenField4);
                form.appendChild(hiddenField5);

                document.body.appendChild(form);
                form.submit();
            }
            else {
                // alert("넌 잘하고이써 헷갈릴때면");
                return false;
            }
            {% else %}
            alert(calEvent.title + '\n시작: ' + calEvent.start.format('YYYY-MM-DD HH:mm:SS')
            + '\n끝: ' + calEvent.end.format('YYYY-MM-DD HH:mm:SS'));
            {% endif %}
        },
        defaultView: $(window).width() >= 818 ? 'agendaWeek':'agendaFiveDay',
        allDaySlot: false,
        // allDayText: '오전 우선권\n(드럼, 합주)',
        height: $(window).height()*0.90,
        // nowIndicator: true,
        eventTextColor: '#fff',
        minTime: "06:00:00",
        maxTime: "30:00:00",
        firstDay: 1,
        titleFormat: 'YYYY년 MMMM',
        timeFormat: 'h(:m)',
        slotLabelFormat: 'h',
        columnHeaderHtml: function(mom) {
        	return '<span class="c1">' + mom.format('ddd') + '</span><br>' + '<span class="c2">' + mom.format('D') + '</span>'
        },
        monthNames: ["1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"],
        monthNamesShort: ["1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"],
        dayNames: ["일요일", "월요일", "화요일", "수요일", "목요일", "금요일", "토요일"],
        dayNamesShort: ["일", "월", "화", "수", "목", "금", "토"],
        buttonText: {
            today: "오늘",
            month: "월별",
            week: "주별",
            listWeek: "리스트",
            day: "일별",
            agendaFiveDay: "5일",
            agendaThreeDay: "3일",
        },
        // put your options and callbacks here
        {% if user.username == '악의꽃' or user.username == '악의꽃admin' %}
            events: '/schedule/api/occurrences?calendar_slug=LFDM'
            {% elif user.username == '막무간애' or user.username == '막무간애admin' %}
            events: '/schedule/api/occurrences?calendar_slug=MMGE'
            {% elif user.username == '모여락' or user.username == '모여락admin' %}
            events: '/schedule/api/occurrences?calendar_slug=MYR'
        {% endif %}
    })

});
</script>
</div>

{% endblock %}
